# Сервис для создания сокращенной формы передаваемых URL и анализа активности их использования

## Стек.

`FastAPI`, `PostgreSQL`, `SQLAlchemy`, `pydantic`, `alembic`, `uvicorn`, `Docker`.

## Запуск приложения.

```bash
$ docker-compose up -d --build
$ docker-compose exec web alembic upgrade head
```

`SwaggerUI`: http://127.0.0.1:8080/api/openapi .

## Описание функционала

Реализован **http**-сервис, который обрабатывает поступающие запросы. Сервер стартует по адресу `http://127.0.0.1:8080`.


<details>
<summary> Список эндпойнтов </summary>

1. Получить сокращенный вариант переданного URL
```python
POST /
```

Request
```json
https://...
```

Метод принимает в теле запроса строку URL для сокращения и возвращает ответ с кодом `201`.


2. Вернуть оригинальный URL
```python
GET /<url_id>
```
Метод принимает в качестве параметра идентификатор сокращенного URL и возвращает ответ с кодом `307` и оригинальным URL в заголовке `Location`.

3. Возможность "удаления" сохраненного URL. Запись остается, но помечается как удаленная. При попытке получения полного URL возвращать ответ с кодом `410 Gone`.
```python
DELETE /<url_id>
```

4. Вернуть статус использования URL
```python
GET /<url_id>/status?[full-info]&&[max-result=10]&&[offset=0]
```
Метод принимает в качестве параметра идентификатор сокращенного URL и возвращает информацию о количестве переходов, совершенных по ссылке.

В ответе может содержаться как общее количество совершенных переходов, так и дополнительная детализированная информация о каждом переходе (наличие **query**-параметра **full-info** и параметров пагинации):
- время перехода/использования ссылки;
- информация о клиенте, выполнившем запрос;

5. Передача ссылок пачками (batch upload)
```python
POST /shorten
```
Принимает в теле запроса список URL в формате:
```json
[
    {
        "original_url": "URL for shorten"
    },
    ...
]

```
и возвращает данные в формате:
```json
[
    {
        "url_id": "<text-id>",
        "short_url": "https://...",
    },
    ...
]
```
</details>

Также реализован **middlware**, блокирующий доступ к сервису запросов из запрещенных подсетей (black list).
